function initMacShortcuts(){key.filter=function(){return!0},key("⌘+c, ctrl+c",function(){document.execCommand("copy")}),key("⌘+v, ctrl+v",function(){document.execCommand("paste")}),key("⌘+x, ctrl+x",function(){document.execCommand("cut")})}function saveSettings(t){fs.writeFile(settingsLocation,JSON.stringify(settings),function(n){if(n)throw n;console.log("Wrote to -> settings.json"),null!==t&&"function"==typeof t&&t()})}function saveCommands(t){fs.writeFile(commandsLocation,JSON.stringify(commands),function(n){if(n)throw n;console.log("Wrote to -> commands.json"),null!==t&&"function"==typeof t&&t()})}function readSettings(t){fs.readFile(settingsLocation,function(n,e){if(n)throw n;settings=JSON.parse(e),null!==t&&t()})}function readCommands(t){fs.readFile(commandsLocation,function(n,e){if(n)throw n;commands=JSON.parse(e),null!==t&&t()})}function reloadCommandList(){readCommands(function(){var t=$("#lstCommands");t.html("");for(var n=0;n<commands.length;n++){var e=commands[n],o=$("<a href='javascript:void(0)' data-id='"+n+"' onclick='loadCommandView("+n+")' class='list-group-item'><b>"+e.name+"</b><p class='list-group-item-text text-muted'>"+e.url+"</p></a>");t.prepend(o)}})}function startServer(){readCommands(function(){readSettings(function(){server=http.createServer(function(t,n){for(var e=0;e<commands.length;e++){var o=commands[e];if(o.url.toLowerCase()===t.url.toLowerCase())return executeCommand(o.command),void(t&&t.socket.end())}t&&t.socket.end()}),server.listen(settings.port,settings.bind)})}),win.on("close",function(){try{server&&server.close()}catch(t){console.log(t)}this.close(!0)})}function executeCommand(t){function n(t,n,e){settings.logOutput&&(n&&console.log(n),e&&console.error(e)),sys.puts(n)}exec(t,n)}function loadCommandView(t){$(".container .list-group-item").removeClass("active"),-1==t?(commands.push({name:"New Command",command:"",url:""}),t=commands.length-1,$("#btnDeleteCommand").hide(),$("#btnAddCommand.list-group-item").addClass("active")):($("#btnDeleteCommand").show(),$("#lstCommands .list-group-item[data-id="+t+"]").addClass("active"));var n=commands[t],e=$("#command-area");$("#txtCommandTitle").data("id",t),$("#btnSaveCommand").data("id",t),$("#btnDeleteCommand").data("id",t),$("#txtCommandTitle").val(n.name),$("#txtCommand").val(n.command),$("#txtUrl").val(n.url),e.show()}initMacShortcuts();var gui=require("nw.gui"),fs=require("fs"),mkdirp=require("mkdirp"),ip=require("ip"),http=require("http"),sys=require("sys"),exec=require("child_process").exec,win=gui.Window.get(),settingsLocation="./files/settings.json",commandsLocation="./files/commands.json",settings,commands;fs.existsSync(settingsLocation)?console.log("settings.json was found"):(settings={bind:"0.0.0.0",port:8080,logOutput:!0},mkdirp("./files/"),saveSettings()),fs.existsSync(commandsLocation)?console.log("commands.json was found"):(commands=[{name:"Lock Computer",command:"echo hi",url:"/lockcomputer"}],saveCommands());var tries=0,server;!function(t){t("[title]").tooltip(),t("#close-menu-item").click(function(){win.close()}),t("#settings-menu-item").click(function(){var n=t(".settings");"0px"==n.css("left")?(n.animate({left:"-250px"},300),t("#settings-menu-item").removeClass("active")):(n.animate({left:"0"},300),t("#settings-menu-item").addClass("active"))}),t("#info-menu-item").click(function(){var n=t(".info");"0px"==n.css("bottom")?(n.animate({bottom:"-31px"},300),t("#info-menu-item").removeClass("active")):(n.animate({bottom:"0"},300),t("#info-menu-item").addClass("active"))}),t("#minimize-menu-item").click(function(){var t,n=gui.Window.get();n.on("minimize",function(){this.hide(),t=new gui.Tray({icon:"img/icon-xs.png"}),t.on("click",function(){n.show(),this.remove(),t=null})}),n.minimize()}),t("#btnSaveSettings").click(function(){settings.bind=t("#txtIPAddress").val(),settings.port=t("#txtPort").val(),settings.logOutput=t("#chkCommandOutput").is(":checked"),saveSettings(function(){swal("Sweet!","Successfully saved settings!","success"),t(".settings").animate({left:"-250px"},300)})}),t("#txtCommandTitled").click(function(){var n=t(this).data("id");bootbox.prompt("Rename this command to?",function(t){null!==t&&(commands[n].name=t,loadCommandView(n))})}),t("#btnDeleteCommand").click(function(){var n=t(this).data("id");bootbox.confirm("Are you sure you want to delete the command?",function(t){t&&(commands.splice(n,1),saveCommands(function(){reloadCommandList()}))})}),t("#btnAddCommand").click(function(){loadCommandView(-1)}),t("#btnSaveCommand").click(function(){var n=t(this).data("id"),e=commands[n],o=t(this);o.button("loading"),e.name=t("#txtCommandTitle").val(),e.command=t("#txtCommand").val(),e.url=t("#txtUrl").val(),saveCommands(function(){swal("Sweet!","Successfully saved command!","success"),reloadCommandList(),o.button("reset")})}),t("#btnDebugWindow").click(function(){win.showDevTools()}),readSettings(function(){t("#lblLocalIP").html(ip.address()+":<span class='text-muted'>"+settings.port+"</span>"),t("#txtIPAddress").val(settings.bind),t("#txtPort").val(settings.port),t("#chkCommandOutput").prop("checked",settings.logOutput)}),reloadCommandList(),startServer()}(jQuery);